<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Ultimate Racing Online v21</title>
    <link rel="stylesheet" href="style.css">
    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

<!-- CONSOLA DE DEPURACI√ìN -->
<div id="debug-console">
    <div style="color:#aaa;">> Initializing System...</div>
</div>

<!-- PANTALLA DE INICIO / LOBBY -->
<div id="start-screen">
    <div id="intro-panel">
        <h1>ULTIMATE ONLINE</h1>
        <p>Servidor Autoritativo v2.1</p>
        <button id="btn-start" onclick="enterLobby()">CONECTAR AL SERVIDOR</button>
    </div>

    <!-- Panel de Lobby (Oculto al inicio) -->
    <div id="lobby-ui">
        <h2>SALA DE ESPERA</h2>
        <div style="display:flex; gap:10px;">
            <button class="menu-item" style="background:#444; border:none; padding:10px 20px; border-radius:20px; cursor:pointer; color:white; font-weight:bold;" onclick="createGameRoom()">CREAR SALA</button>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
            <input type="text" id="room-code-input" class="lobby-input" placeholder="C√ìDIGO DE SALA">
            <button class="menu-item" style="background:#3388ff; border:none; padding:10px 20px; border-radius:20px; cursor:pointer; color:white; font-weight:bold;" onclick="joinGameRoom()">UNIRSE</button>
        </div>
        <p id="server-status" style="font-size:0.8rem; color:#666;">Esperando conexi√≥n...</p>
    </div>
</div>

<!-- PANTALLA DE CARGA -->
<div id="loading">
    <span class="loader"></span>
    <div>Sincronizando con Servidor...</div>
</div>

<!-- INTERFAZ DE JUEGO -->
<div id="ui-layer">
    <div id="fps-counter">FPS: 60</div>

    <div id="menu-btn" class="pointer-events-auto">‚ò∞</div>
    
    <div id="menu-modal" class="pointer-events-auto">
        <div class="menu-item">
            <span>Mostrar FPS</span>
            <label class="switch">
                <input type="checkbox" id="chk-fps" checked>
                <span class="slider-switch"></span>
            </label>
        </div>
        <div class="menu-item">
            <span>Slider Auto</span>
            <label class="switch">
                <input type="checkbox" id="chk-slider" checked>
                <span class="slider-switch"></span>
            </label>
        </div>
        
        <div class="menu-group-title">CONFIG SALA (ADMIN)</div>
        <!-- Solo visual por ahora en cliente, la l√≥gica real est√° en el servidor -->
        <div class="menu-item">
            <span>Vel. M√°x (km/h)</span>
            <input type="range" id="manual-max-speed" class="menu-range" min="120" max="999" value="500">
            <span id="disp-max-speed" class="val-display">500</span>
        </div>
        
        <div class="menu-item">
            <span>Acel. (km/h/s)</span>
            <input type="range" id="manual-accel" class="menu-range" min="15" max="99" value="40">
            <span id="disp-accel" class="val-display">+40</span>
        </div>

        <div class="menu-group-title">CONTROLES</div>
        <div class="menu-item">
            <span>Invertir Direcci√≥n</span>
            <label class="switch">
                <input type="checkbox" id="chk-invert-steering">
                <span class="slider-switch"></span>
            </label>
        </div>
        <div class="menu-item">
            <span>Bot√≥n Freno</span>
            <label class="switch">
                <input type="checkbox" id="chk-show-brake" checked>
                <span class="slider-switch"></span>
            </label>
        </div>
        <div class="menu-item">
            <span>Sensibilidad Giro</span>
            <input type="range" id="steer-sens" class="menu-range" min="10" max="150" value="60">
            <span id="disp-sens" class="val-display">60%</span>
        </div>
        <div class="menu-item">
            <span>Restricci√≥n Vel.</span>
            <input type="range" id="steer-stiff" class="menu-range" min="0" max="100" value="50">
            <span id="disp-stiff" class="val-display">50%</span>
        </div>

        <div class="menu-group-title">MODO</div>
        <div class="menu-item">
            <span id="mode-label" style="font-weight:bold; color:#ffaa00;">MANUAL (ONLINE)</span>
            <label class="switch">
                <!-- Forzamos manual en online por defecto -->
                <input type="checkbox" id="chk-mode" checked disabled>
                <span class="slider-switch" style="opacity:0.5;"></span>
            </label>
        </div>
    </div>

    <div id="auto-controls" class="pointer-events-auto">
        <label style="font-size:12px; font-weight:bold; letter-spacing:1px;">VELOCIDAD CRUCERO</label>
        <input type="range" id="speedSlider" class="main-slider" min="0" max="1000" value="100">
    </div>

    <div id="manual-controls" style="display:block;"> <!-- Por defecto visible en online -->
        <div id="hud-speed">
            <span id="speed-display">0</span><small> KM/H</small>
        </div>
        
        <div id="joystick-zone" class="pointer-events-auto">
            <div id="joystick-knob"></div>
        </div>

        <div id="brake-btn" class="pedal pointer-events-auto">üõë</div>
        <div id="gas-btn" class="pedal pointer-events-auto">‚ö°</div>
    </div>
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
</script>
<script type="module" src="main.js"></script>
</body>
</html>